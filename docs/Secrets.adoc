= Organization Secrets
:toc:

== Overview

This document defines which secrets should be managed at organization level vs repository level.

== Organization-Level Secrets

These secrets are **shared across all repositories** and should be configured once at the organization level.

Set at: `https://github.com/organizations/cui-oss/settings/secrets/actions`

[cols="1,2,1"]
|===
|Secret |Purpose |Used By

|`RELEASE_APP_ID`
|cuioss-release-bot GitHub App ID
|maven-release.yml

|`RELEASE_APP_PRIVATE_KEY`
|cuioss-release-bot private key (.pem)
|maven-release.yml

|`OSS_SONATYPE_USERNAME`
|Maven Central / Sonatype OSSRH username
|maven-build.yml, maven-release.yml

|`OSS_SONATYPE_PASSWORD`
|Maven Central / Sonatype OSSRH password
|maven-build.yml, maven-release.yml

|`GPG_PRIVATE_KEY`
|GPG private key for artifact signing
|maven-build.yml, maven-release.yml

|`GPG_PASSPHRASE`
|GPG key passphrase
|maven-build.yml, maven-release.yml

|`PAGES_DEPLOY_TOKEN`
|PAT for deploying to cuioss.github.io
|maven-release.yml

|`SONAR_TOKEN`
|SonarCloud authentication token
|maven-build.yml
|===

=== Why Organization-Level?

* **Same credentials** - All cuioss repos deploy to same Maven Central account
* **Same signing key** - All artifacts signed with same GPG key
* **Same release bot** - Single GitHub App for all repos
* **Easier rotation** - Update once, applies everywhere
* **Security** - Fewer copies of sensitive credentials
* **SonarCloud** - Organization uses a single SonarCloud token for all projects

== npm Publishing (No Token Required)

The `reusable-npm-publish.yml` workflow uses **OIDC Trusted Publishing** instead of a stored npm token.
GitHub's OIDC provider authenticates directly with the npm registry during publish.

* No `NPM_TOKEN` org secret is needed
* Requires `id-token: write` permission in the caller workflow
* Requires an `npm-publish` GitHub Environment configured in the consumer repo
* The npm trusted publisher must be configured on npmjs.com (repository, environment, workflow filename)
* Uses existing `RELEASE_APP_ID` and `RELEASE_APP_PRIVATE_KEY` for git tag/push operations only

== Migration Checklist

When migrating repos to the organization:

=== Organization Setup (Once)

* [ ] Add `RELEASE_APP_ID`
* [ ] Add `RELEASE_APP_PRIVATE_KEY`
* [ ] Add `OSS_SONATYPE_USERNAME`
* [ ] Add `OSS_SONATYPE_PASSWORD`
* [ ] Add `GPG_PRIVATE_KEY`
* [ ] Add `GPG_PASSPHRASE`
* [ ] Add `PAGES_DEPLOY_TOKEN`
* [ ] Add `SONAR_TOKEN`

=== Per-Repository Setup

* [ ] Remove any org-level secrets from repo (now inherited)

== Secret Visibility

When adding organization secrets, set repository access to:

* **All repositories** - For secrets used by all repos
* **Selected repositories** - If you need to restrict access

Recommended: Use "All repositories" for the org-level secrets listed above.

== Security Notes

* Never commit secrets to repositories
* Rotate credentials periodically
* Use GitHub's secret scanning to detect leaks
* Organization secrets are inherited but cannot be read by repo admins
* Workflow logs automatically mask secret values
