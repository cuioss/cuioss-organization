= Branch Protection
:toc:

== Purpose

Automates creation of consistent branch protection rulesets across all cuioss repositories.

== Files

[cols="1,2"]
|===
|File |Description

|`config.json`
|Configuration: repos, ruleset rules, bypass actors

|`setup-branch-protection.py`
|Script to apply branch protection rulesets via GitHub API
|===

== Prerequisites

* Python 3.10+
* https://cli.github.com/[GitHub CLI] (`gh`) - authenticated

[source,bash]
----
gh auth login
----

== Usage

1. Edit `config.json` - add/remove repositories, adjust rules
2. Run the script:
+
[source,bash]
----
./setup-branch-protection.py
----

== Configuration

=== Repositories

Add repos to the `repositories` array in `config.json`:

[source,json]
----
{
  "repositories": [
    "OAuth-Sheriff",
    "cui-java-parent",
    "my-new-repo"
  ]
}
----

=== Ruleset Rules

Adjust protection settings under `ruleset.rules`:

[source,json]
----
{
  "ruleset": {
    "rules": {
      "require_pull_request": {
        "required_approving_review_count": 1
      },
      "require_status_checks": {
        "required_checks": ["build", "test"]
      }
    }
  }
}
----

=== Bypass Actor

The `cuioss-release-bot` is configured as bypass actor by default.

== Dry Run

To test without applying changes, set enforcement to `evaluate`:

[source,json]
----
{
  "ruleset": {
    "enforcement": "evaluate"
  }
}
----
